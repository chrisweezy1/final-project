!function(){var a;if(a={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.emit=function(c){var d,e,f,g;if(b[c]){for(g=b[c],e=0,f=g.length;e<f;e++)d=g[e],d.apply(a,Array.prototype.slice.call(arguments,1));return a}},a}},window.Gridle={_inited:!1,_isReady:!1,_statesInCss:null,_statesFindedInCss:!1,_cssLinks:[],_cssSettings:[],_states:[],_activeStates:[],_activeStatesNames:[],_inactiveStates:[],_inactiveStatesNames:[],_updatedStates:[],_updatedStatesNames:[],resizeTimeout:null,_settings:{cssPath:null,onUpdate:null,debug:null},init:function(a){var b,c,d;if(this._inited=!0,null!=a&&(this._settings=a),a&&null!=a.debug&&(null!=this._settings.debug||a.debug),a&&null!=a.onStatesChange&&(null!=this._settings.onStatesChange||a.onStatesChange),this._debug("ajax request on stylesheets to find gridle states"),this._settings.cssPath)this._cssLinks.push({href:this._settings.cssPath});else{d=document.getElementsByTagName("link");for(b in d){if(!(c=d[b])||"alternate"===c.rel)return!1;this._cssLinks.push(c)}}return this._loadAndParseCss(this._cssLinks.length?void 0:this._launch)},_loadAndParseCss:function(){var a,b,c;c=this._cssLinks;for(a in c){if(b=c[a],this._statesFindedInCss)return!1;b&&b.href&&(this._debug("|--- ajax request on ",b.href),this._ajax({async:!0,url:b.href,success:function(a){return function(c){var d;return!a._statesFindedInCss&&(c&&(d=c.match(/#gridle-settings(?:\s*)\{(?:\s*)content(?:\s*):(?:\s*)\'(.+)\';/)&&RegExp.$1)?(d=JSON.parse(d),a._cssSettings=d,d.states?(a._debug("|--- states finded in",b.href),a._statesFindedInCss=!0,a._statesInCss=d.states,a._processFindedStates()):(a._debug("no queries finded in css"),a._noSettingsFindedInThisCss(b),!1)):(a._noSettingsFindedInThisCss(b),!1))}}(this),error:function(a){return function(c){return!a._statesFindedInCss&&a._noSettingsFindedInThisCss(b)}}(this),dataType:"text"}))}},_noSettingsFindedInThisCss:function(a){if(this._cssLinks.shift,!this._cssLinks.length)return this._debug("no settings finded in css")},_processFindedStates:function(){var a,b,c;this._debug("begin process finded states in css"),c=this._statesInCss;for(a in c)b=c[a],this._registerState(a,b);return this._launch()},_launch:function(){return this._debug("launch"),this._isReady=!0,this._crossEmit("ready"),this._addEvent(window,"resize",function(a){return function(b){return clearTimeout(a.resizeTimeout),a.resizeTimeout=setTimeout(function(){return a._onResize()},100)}}(this)),this._onResize()},_onResize:function(){return[],this._updateStatesStatus()},_registerState:function(a,b,c){var d;return d={name:a,query:b.query,settings:b,status:null,previous_status:null,updateOnResize:null==c||c},this._states.push(d),this._debug("|--- register state",a,d)},_updateStatesStatus:function(){var a,b,c;this._activeStates=[],this._activeStatesNames=[],this._inactiveStates=[],this._inactiveStatesNames=[],this._updatedStates=[],this._updatedStatesNames=[],c=this._states;for(a in c)b=c[a],b.updateOnResize&&(this._states[a].previous_status=b.status,this._validateState(b)?(this._states[a].status||(this._updatedStates.push(b),this._updatedStatesNames.push(b.name)),this._states[a].status=!0,this._activeStates.push(b),this._activeStatesNames.push(b.name)):(this._states[a].status&&(this._updatedStates.push(b),this._updatedStatesNames.push(b)),this._states[a].status=!1,this._inactiveStates.push(b),this._inactiveStatesNames.push(b.name)));if(this._updatedStates.length&&this._crossEmit("update",this._updatedStates,this._activeStates,this._inactiveStates),this._updatedStates.length&&this._settings.onUpdate)return this._settings.onUpdate(this._updatedStates,this._activeStates,this._inactiveStates)},_validateState:function(a){return matchMedia(a.query).matches},_addEvent:function(a,b,c){return!!a&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c)},_crossEmit:function(a){return"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery(this).trigger(a,Array.prototype.slice.call(arguments,1)),jQuery("body").trigger("gridle."+a,Array.prototype.slice.call(arguments,1))),this.emit.apply(this,arguments)},_ajax:function(a){var b,c;return b={type:a.type||"GET",url:a.url,success:a.success,error:a.error,dataType:a.dataType||"text",context:a.context},c=new XMLHttpRequest,b.context&&(c.context=b.context),c.open(b.type,b.url,!1),c.onreadystatechange=function(){var a;if(4!==c.readyState)return!1;switch(c.status){case 200:switch(b.dataType){case"json":a=JSON.parse(c.responseText);break;default:a=c.responseText}if(b.success)return b.success(a,c.status,c)}},c.send()},getRegisteredStates:function(){return this._states},getUpdatedStates:function(){return this._updatedStates},getUpdatedStatesNames:function(){return this._updatedStatesNames},getActiveStates:function(){return this._activeStates},getActiveStatesNames:function(){return this._activeStatesNames},getInactiveStates:function(){return this._inactiveStates},getInactiveStatesNames:function(){return this._inactiveStatesNames},isActive:function(a){var b,c,d,e;c=!1,e=this._activeStatesNames;for(b in e)d=e[b],a===d&&(c=!0);return c},isReady:function(){return this._isReady},_debug:function(){this._settings.debug}},a.convert(window.Gridle),setTimeout(function(){if(!Gridle._inited)return Gridle.init()},500),"function"==typeof window.define&&window.define.amd)window.define([],function(){return window.Gridle})}();
window.matchMedia=window.matchMedia||function(a){"use strict";var b,c=a.documentElement,d=c.firstElementChild||c.firstChild,e=a.createElement("body"),f=a.createElement("div");return f.id="mq-test-1",f.style.cssText="position:absolute;top:-100em",e.style.background="none",e.appendChild(f),function(a){return f.innerHTML='&shy;<style media="'+a+'"> #mq-test-1 { width: 42px; }</style>',c.insertBefore(e,d),b=42===f.offsetWidth,c.removeChild(e),{matches:b,media:a}}}(document),function(a){"use strict";function b(){u(!0)}var c={};if(a.respond=c,c.update=function(){},c.mediaQueriesSupported=a.matchMedia&&a.matchMedia("only all").matches,!c.mediaQueriesSupported){var d,e,f,g=a.document,h=g.documentElement,i=[],j=[],k=[],l={},m=g.getElementsByTagName("head")[0]||h,n=g.getElementsByTagName("base")[0],o=m.getElementsByTagName("link"),p=[],q=function(){for(var b=0;o.length>b;b++){var c=o[b],d=c.href,e=c.media,f=c.rel&&"stylesheet"===c.rel.toLowerCase();d&&f&&!l[d]&&(c.styleSheet&&c.styleSheet.rawCssText?(s(c.styleSheet.rawCssText,d,e),l[d]=!0):(!/^([a-zA-Z:]*\/\/)/.test(d)&&!n||d.replace(RegExp.$1,"").split("/")[0]===a.location.host)&&p.push({href:d,media:e}))}r()},r=function(){if(p.length){var b=p.shift();v(b.href,function(c){s(c,b.href,b.media),l[b.href]=!0,a.setTimeout(function(){r()},0)})}},s=function(a,b,c){var d=a.match(/@media[^\{]+\{([^\{\}]*\{[^\}\{]*\})+/gi),e=d&&d.length||0;b=b.substring(0,b.lastIndexOf("/"));var f=function(a){return a.replace(/(url\()['"]?([^\/\)'"][^:\)'"]+)['"]?(\))/g,"$1"+b+"$2$3")},g=!e&&c;b.length&&(b+="/"),g&&(e=1);for(var h=0;e>h;h++){var k,l,m,n;g?(k=c,j.push(f(a))):(k=d[h].match(/@media *([^\{]+)\{([\S\s]+?)$/)&&RegExp.$1,j.push(RegExp.$2&&f(RegExp.$2))),m=k.split(","),n=m.length;for(var o=0;n>o;o++)l=m[o],i.push({media:l.split("(")[0].match(/(only\s+)?([a-zA-Z]+)\s?/)&&RegExp.$2||"all",rules:j.length-1,hasquery:l.indexOf("(")>-1,minw:l.match(/\(\s*min\-width\s*:\s*(\s*[0-9\.]+)(px|em)\s*\)/)&&parseFloat(RegExp.$1)+(RegExp.$2||""),maxw:l.match(/\(\s*max\-width\s*:\s*(\s*[0-9\.]+)(px|em)\s*\)/)&&parseFloat(RegExp.$1)+(RegExp.$2||"")})}u()},t=function(){var a,b=g.createElement("div"),c=g.body,d=!1;return b.style.cssText="position:absolute;font-size:1em;width:1em",c||(c=d=g.createElement("body"),c.style.background="none"),c.appendChild(b),h.insertBefore(c,h.firstChild),a=b.offsetWidth,d?h.removeChild(c):c.removeChild(b),a=f=parseFloat(a)},u=function(b){var c="clientWidth",l=h[c],n="CSS1Compat"===g.compatMode&&l||g.body[c]||l,p={},q=o[o.length-1],r=(new Date).getTime();if(b&&d&&30>r-d)return a.clearTimeout(e),void(e=a.setTimeout(u,30));d=r;for(var s in i)if(i.hasOwnProperty(s)){var v=i[s],w=v.minw,x=v.maxw,y=null===w,z=null===x;w&&(w=parseFloat(w)*(w.indexOf("em")>-1?f||t():1)),x&&(x=parseFloat(x)*(x.indexOf("em")>-1?f||t():1)),v.hasquery&&(y&&z||!(y||n>=w)||!(z||x>=n))||(p[v.media]||(p[v.media]=[]),p[v.media].push(j[v.rules]))}for(var A in k)k.hasOwnProperty(A)&&k[A]&&k[A].parentNode===m&&m.removeChild(k[A]);for(var B in p)if(p.hasOwnProperty(B)){var C=g.createElement("style"),D=p[B].join("\n");C.type="text/css",C.media=B,m.insertBefore(C,q.nextSibling),C.styleSheet?C.styleSheet.cssText=D:C.appendChild(g.createTextNode(D)),k.push(C)}},v=function(a,b){var c=w();c&&(c.open("GET",a,!0),c.onreadystatechange=function(){4!==c.readyState||200!==c.status&&304!==c.status||b(c.responseText)},4!==c.readyState&&c.send(null))},w=function(){var b=!1;try{b=new a.XMLHttpRequest}catch(c){b=new a.ActiveXObject("Microsoft.XMLHTTP")}return function(){return b}}();q(),c.update=q,a.addEventListener?a.addEventListener("resize",b,!1):a.attachEvent&&a.attachEvent("onresize",b)}}(this);
